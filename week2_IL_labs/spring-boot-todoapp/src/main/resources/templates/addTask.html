<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>To-Do List</title>
</head>
<body>
<h1>To-Do List</h1>

<!-- Form to add new task -->
<form id="addTaskForm">
    <input type="text" id="taskName" placeholder="Task Name" required>
    <input type="text" id="description" placeholder="Description">
    <input type="date" id="dueDate">
    <button type="button" onclick="addTask()">Add Task</button>
</form>

<!-- List to display existing tasks -->
<ul id="taskList"></ul>

<script>
    // Function to fetch and display existing tasks
    function displayTasks() {
        fetch("/tasks")
            .then(response => {
                if (!response.ok) {
                    throw new Error("Failed to fetch tasks");
                }
                return response.json();
            })
            .then(tasks => {
                // Clear the existing list
                document.getElementById("taskList").innerHTML = "";
                // Loop through each task and append it to the list
                tasks.forEach(task => {
                    var listItem = document.createElement("li");
                    listItem.innerHTML = `
                            <span>${task.taskName}</span>
                            <span>${task.description}</span>
                            <span>${task.dueDate}</span>
                            <a href="/deleteTask/${task.id}">Delete</a>
                        `;
                    document.getElementById("taskList").appendChild(listItem);
                });
            })
            .catch(error => {
                console.error("Error fetching tasks:", error);
            });
    }

    // Function to add a new task
    function addTask() {
        var taskData = {
            taskName: document.getElementById("taskName").value,
            description: document.getElementById("description").value,
            dueDate: document.getElementById("dueDate").value
        };

        // Send data as JSON using Fetch API
        fetch("/addTask", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(taskData)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Failed to add task");
                }
                // Refresh the task list after adding a task
                displayTasks();
                console.log("Task added successfully");
            })
            .catch(error => {
                console.error("Error adding task:", error);
            });
    }

    // Call displayTasks function to load existing tasks when the page loads
    displayTasks();
</script>
</body>
</html>
